@model Restaurant.Models.Reservation

@{
    ViewData["Title"] = "Chi tiết đặt bàn";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid">
    <h1 class="mt-4">Chi tiết đặt bàn</h1>
    <div class="card mb-4">
        <div class="card-header">
            <i class="fas fa-info-circle mr-1"></i>
            Thông tin đặt bàn
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <dl class="row">
                        <dt class="col-sm-4">ID:</dt>
                        <dd class="col-sm-8">@Model.ReservationId</dd>

                        <dt class="col-sm-4">Họ tên:</dt>
                        <dd class="col-sm-8">@Model.FullName</dd>

                        <dt class="col-sm-4">Số điện thoại:</dt>
                        <dd class="col-sm-8">@Model.Phone</dd>

                        <dt class="col-sm-4">Email:</dt>
                        <dd class="col-sm-8">@Model.Email</dd>
                    </dl>
                </div>
                <div class="col-md-6">
                    <dl class="row">
                        <dt class="col-sm-4">Số khách:</dt>
                        <dd class="col-sm-8">@Model.NumberOfGuests</dd>

                        <dt class="col-sm-4">Ngày đặt:</dt>
                        <dd class="col-sm-8">@Model.ReservationDate.ToString("dd/MM/yyyy HH:mm")</dd>

                        <dt class="col-sm-4">Trạng thái:</dt>
                        <dd class="col-sm-8">
                            <select class="form-control status-select" data-id="@Model.ReservationId">
                                @{
                                    var statuses = new[] {
                                        new { Value = "Available", Text = "Trống", Selected = Model.Status == ReservationStatus.Available },
                                        new { Value = "Pending", Text = "Chờ xác nhận", Selected = Model.Status == ReservationStatus.Pending },
                                        new { Value = "Confirmed", Text = "Đã xác nhận", Selected = Model.Status == ReservationStatus.Confirmed },
                                        new { Value = "Cancelled", Text = "Đã hủy", Selected = Model.Status == ReservationStatus.Cancelled },
                                        new { Value = "Completed", Text = "Hoàn thành", Selected = Model.Status == ReservationStatus.Completed }
                                    };
                                }
                                @foreach (var status in statuses)
                                {
                                    <option value="@status.Value" selected="@status.Selected">@status.Text</option>
                                }
                            </select>
                        </dd>

                        <dt class="col-sm-4">Yêu cầu đặc biệt:</dt>
                        <dd class="col-sm-8">@(string.IsNullOrEmpty(Model.SpecialRequest) ? "Không có" : Model.SpecialRequest)</dd>
                    </dl>
                </div>
            </div>
            <div class="mt-4">
                <a asp-action="Index" class="btn btn-secondary">Quay lại</a>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('.status-select').change(function () {
                var id = $(this).data('id');
                var status = $(this).val();
                $.post('/Admin/AdminReservation/UpdateStatus', { id: id, status: status }, function (result) {
                    if (result.success) {
                        toastr.success('Cập nhật trạng thái thành công');
                    } else {
                        toastr.error('Cập nhật trạng thái thất bại');
                    }
                });
            });
        });
    </script>
} 